name: CI from Subdirectory

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Change to subdirectory
      working-directory: ./subdirectory  # ← МЕНЯЕМ КАТАЛОГ!
    
    - name: List files
      run: pwd && ls -la  # Проверяем где мы
    
    - name: Install dependencies
      working-directory: ./subdirectory
      run: |
        sudo apt-get update
        sudo apt-get install -y g++ make python3 python3-pip
        pip3 install pytest
    
    - name: Build
      working-directory: ./subdirectory
      run: make
    
    - name: Run tests
      working-directory: ./subdirectory
      run: |
        sudo chmod a+rw /etc/passwd
        pytest tests/ -v
